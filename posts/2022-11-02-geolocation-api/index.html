<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geolocation API</title>
    <meta name="description" content="Trying out the Geolocation API">
    
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/ol@v7.1.0/dist/ol.js"></script>
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@v7.1.0/ol.css">
    
    <link rel="stylesheet" href="/css/prism-base16-monokai.dark.css">
    <link rel="stylesheet" href="/css/prism-diff.css">
    <link rel="stylesheet" href="/css/index.css">
    <link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="salta.to">
    <link rel="alternate" href="/feed/feed.json" type="application/json" title="salta.to">
  </head>
  <body>
    <div class="wide-view">
      <header class="page-header">
        <div class="home"><a href="/">salta.to</a></div>
        <ul class="nav">
          <li class="nav-item"><a href="/">Home</a></li>
          <li class="nav-item"><a href="/posts/">Archive</a></li>
          <li class="nav-item"><a href="/about/">About</a></li>
        </ul>
      </header>
    </div>
    <main class="tmpl-post">
      <div class="small-view">
  <h1>Geolocation API</h1>

  <time datetime="2022-11-01">1 Nov 2022</time>
  <a href="/tags/web-dev/" class="post-tag">web dev</a>
  <a href="/tags/api/" class="post-tag">API</a>
</div>

<div class="small-view">
<p>Getting the longitude and latitude from the browser or by entering the data manually in the form.</p>
<ul>
<li>Using the <a href="https://openlayers.org/">OpenLayers</a> to display the location on a map.</li>
<li>Using <a href="https://www.openstreetmap.org/">OpenStreetMap</a> to display the map</li>
<li>Using <a href="https://nominatim.openstreetmap.org/">Nominatim</a> to get the address information</li>
</ul>
<fieldset style="display:flex; flex-direction: column;">
  <label for="lon" style="line-height:1.6">Longitude</label>
  <input id="lon" type="number" step="0.000001" style="line-height:1.6"><br>
  <label for="lat" style="line-height:1.6">Latitude</label>
  <input id="lat" type="number" step="0.000001" style="line-height:1.6">
  <button id="reversegeocoding" type=button name="button" style="margin-top: 2rem; width: 40%; line-height:1.6;">Reverse geocode</button>
</fieldset>
<p>When you â€œReverse Geocode&quot; the longitude and latitude</p>
<ul>
<li>adresinfo is shown below</li>
<li>the map is zoomed to the adres</li>
</ul>
<h2 id="address-information" tabindex="-1">Address information <a class="direct-link" href="#address-information" aria-hidden="true">#</a></h2>
<div id="address" style="visibility: hidden; background-color: hotpink; color: black;margin-bottom: 3rem; padding: 2rem;">
</div>
<div id="map" class="map" tabindex="0"></div>
<div class="btns-zoom">
  <button id="zoom-out">Zoom out</button>
  <button id="zoom-in">Zoom in</button>
</div>
<p>You can also click on the map to display address information for a specific location.</p>
<ul>
<li>Ideas taken from: <a href="https://typefully.com/MrunayU/0nKOdpl">Mrunay Uttarwar</a> and  <a href="https://gist.github.com/ThomasG77/26e61508217ba86a04c19a67cbda0e99">Simple OpenLayers Reverse Geocoding sample with Nominatim</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Geolocation_API">Documentation Geolocation API</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Geolocation_API#browser_compatibility">Browser compatibility</a></li>
</ul>
<h2 id="source" tabindex="-1">Source <a class="direct-link" href="#source" aria-hidden="true">#</a></h2>
<p>The <a href="https://openlayers.org/">OpenLayers</a> JS and CSS in the <code>&lt;head&gt;</code> section of the page:</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.jsdelivr.net/npm/ol@v7.1.0/dist/ol.js<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.jsdelivr.net/npm/ol@v7.1.0/ol.css<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></code></pre>
<h3 id="the-javascript" tabindex="-1">The javascript <a class="direct-link" href="#the-javascript" aria-hidden="true">#</a></h3>
<pre class="language-js"><code class="language-js"><span class="token keyword">var</span> lat <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"lat"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">var</span> lon <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"lon"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">var</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>Map</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>  <span class="token literal-property property">layers</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>    <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>layer<span class="token punctuation">.</span>Tile</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>      <span class="token literal-property property">source</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>source<span class="token punctuation">.</span>OSM</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><br>  <span class="token punctuation">]</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token string">'map'</span><span class="token punctuation">,</span><br>  <span class="token literal-property property">view</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ol<span class="token punctuation">.</span>View</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>    <span class="token literal-property property">center</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>    <span class="token literal-property property">zoom</span><span class="token operator">:</span> <span class="token number">2</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">function</span> <span class="token function">simpleReverseGeocoding</span><span class="token punctuation">(</span><span class="token parameter">lon<span class="token punctuation">,</span> lat</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://nominatim.openstreetmap.org/reverse?format=json&amp;lon='</span> <span class="token operator">+</span> lon <span class="token operator">+</span> <span class="token string">'&amp;lat='</span> <span class="token operator">+</span> lat<span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>response<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">"Response not ok"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">json</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'address'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> json<span class="token punctuation">.</span>display_name<span class="token punctuation">;</span><br>    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'address'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>visibility <span class="token operator">=</span> <span class="token string">'visible'</span><span class="token punctuation">;</span><br>    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'address-information'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>visibility <span class="token operator">=</span> <span class="token string">'visible'</span><span class="token punctuation">;</span><br><br>    map<span class="token punctuation">.</span><span class="token function">getView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setCenter</span><span class="token punctuation">(</span>ol<span class="token punctuation">.</span>proj<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span><span class="token punctuation">[</span>lon<span class="token punctuation">,</span> lat<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'EPSG:4326'</span><span class="token punctuation">,</span> <span class="token string">'EPSG:3857'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    map<span class="token punctuation">.</span><span class="token function">getView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setZoom</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'There was an error with the fetch operation: '</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br>map<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">var</span> coordinate <span class="token operator">=</span> ol<span class="token punctuation">.</span>proj<span class="token punctuation">.</span><span class="token function">toLonLat</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>coordinate<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> val<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> lon <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'lon'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token operator">=</span> coordinate<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>  <span class="token keyword">var</span> lat <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'lat'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token operator">=</span> coordinate<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span><br>  <span class="token function">simpleReverseGeocoding</span><span class="token punctuation">(</span>lon<span class="token punctuation">,</span> lat<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'reversegeocoding'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'lon'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value <span class="token operator">&amp;&amp;</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'lat'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token function">simpleReverseGeocoding</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'lon'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'lat'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'zoom-out'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> view <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">getView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> zoom <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">getZoom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  view<span class="token punctuation">.</span><span class="token function">setZoom</span><span class="token punctuation">(</span>zoom <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'zoom-in'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> view <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">getView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> zoom <span class="token operator">=</span> view<span class="token punctuation">.</span><span class="token function">getZoom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  view<span class="token punctuation">.</span><span class="token function">setZoom</span><span class="token punctuation">(</span>zoom <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span><br><br><span class="token keyword">function</span> <span class="token function">getLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>navigator<span class="token punctuation">.</span>geolocation<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    navigator<span class="token punctuation">.</span>geolocation<span class="token punctuation">.</span><span class="token function">getCurrentPosition</span><span class="token punctuation">(</span>showPosition<span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>    x<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">"Geolocation not supported by this browser"</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">function</span> <span class="token function">showPosition</span><span class="token punctuation">(</span><span class="token parameter">position</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  lat<span class="token punctuation">.</span>value <span class="token operator">=</span> position<span class="token punctuation">.</span>coords<span class="token punctuation">.</span>latitude<span class="token punctuation">;</span><br>  lon<span class="token punctuation">.</span>value <span class="token operator">=</span> position<span class="token punctuation">.</span>coords<span class="token punctuation">.</span>longitude<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token function">getLocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</div>
<style>
#address-information {
  visibility: hidden;
}
#map {
  height: 600px;
}
.btns-zoom {
  margin-block-start: 1rem;
  margin-block-end: 3rem;
}
</style>
<script type="text/javascript" src="/js/example-geolocation-api.js"></script>


<div class="small-view">
  <ul><li>Previous: <a href="/posts/2022-11-01-full-screen-api/">Full screen API</a></li>
  </ul>
</div>

    </main>

    <div class="wide-view">
      <footer class="page-footer">&copy; salta.to <script>document.write(new Date().getFullYear())</script></footer>
    <div class="wide-view">
    <!-- Current page: /posts/2022-11-02-geolocation-api/ -->

  </body>
</html>
